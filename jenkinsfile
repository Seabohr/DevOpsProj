pipeline{
	agent any
	environment {
		PASSWORD = credentials('DBPW')
 		version = "$(curl -s https://api.github.com/repos/docker/compose/releases/latest | jq -r '.tag_name')"

	stages{
		stage('Build-Installation'){
			steps{
				sh "sudo apt update"
				sh "sudo apt install curl jq -y"
				sh "curl https://get.docker.com | sudo bash"
				sh "sudo usermod -aG docker ${whoami}"
				sh 'sudo curl -L "https://github.com/docker/compose/releases/download/${version}/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose'
				sh "sudo chmod +x /usr/local/bin/docker-compose"
		}
		}
		stage ('Build-Compose'){
			steps{

				sh "cd Basefiles"
				sh "sudo docker-compose up -d -e ${PASSWORD}"
		}
		}
		stage ('Test'){
			steps{
				sh "sudo apt install python3-pip -y"
				sh "cd frontend"
				sh "pip3 install -r requirements.txt"
				sh "python3 -m pytest --cov application -report html"
				
			}
	}	}
		}
		}
